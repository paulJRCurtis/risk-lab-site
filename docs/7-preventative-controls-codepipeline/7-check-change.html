<!doctype html><html class=no-js lang=en-us prefix="og: https://ogp.me/ns# fb: https://ogp.me/ns/fb#"><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta property="og:title" content="Risk & Compliance Labs"><meta property="og:type" content="website"><meta property="og:url" content><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name=generator content="Hugo 0.80.0"><meta name=description content="Hands on labs for those interested in risk & assurance, and compliance."><meta name=author content="Amazon AWS"><link rel="shortcut icon" href=https://a0.awsstatic.com/libra-css/images/site/fav/favicon.ico type=image/ico><link rel=icon href=https://a0.awsstatic.com/libra-css/images/site/fav/favicon.ico type=image/ico><title>Deploy change :: Risk & Compliance Labs</title><link href=../css/nucleus.css rel=stylesheet><link href=../css/fontawesome-all.min.css rel=stylesheet><link href=../css/hybrid.css rel=stylesheet><link href=../css/featherlight.min.css rel=stylesheet><link href=../css/perfect-scrollbar.min.css rel=stylesheet><link href=../css/auto-complete.css rel=stylesheet><link href=../css/atom-one-dark-reasonable.css rel=stylesheet><link href=../css/theme.css rel=stylesheet><link href=../css/hugo-theme.css rel=stylesheet><link href=../css/theme-aws.css rel=stylesheet><script src=../js/jquery-3.3.1.min.js></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}:not(pre)>code+span.copy-to-clipboard{display:none}</style></head><body data-url=../7-preventative-controls-codepipeline/7-check-change.html><nav id=sidebar><div id=header-wrapper><div id=header><div><a href=../ title="Go home"><img style=vertical-align:middle src=../images/logo.png height=70px></a></div></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label><input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=../js/lunr.min.js></script><script type=text/javascript src=../js/auto-complete.js></script><script type=text/javascript>var baseurl="";</script><script type=text/javascript src=../js/search.js></script></div><div class=highlightable><ul class=topics><li data-nav-id=/1-start-workshop.html title="Start the Workshop" class=dd-item><a href=../1-start-workshop.html><b></b>Start the Workshop</a><ul><li data-nav-id=/1-start-workshop/on-your-own.html title="In your own account" class=dd-item><a href=../1-start-workshop/on-your-own.html><b></b>On your own</a><ul><li data-nav-id=/1-start-workshop/on-your-own/create-an-aws-account.html title="Create an AWS Account" class=dd-item><a href=../1-start-workshop/on-your-own/create-an-aws-account.html>Create an AWS Account</a></li></ul></li><li data-nav-id=/1-start-workshop/at-an-aws-event.html title="At an AWS Event" class=dd-item><a href=../1-start-workshop/at-an-aws-event.html>At an AWS Event</a><ul><li data-nav-id=/1-start-workshop/at-an-aws-event/aws-workshop-portal.html title="AWS Workshop Portal" class=dd-item><a href=../1-start-workshop/at-an-aws-event/aws-workshop-portal.html><b></b>AWS Workshop Portal</a></li></ul></li></ul></li><li data-nav-id=/2-know-the-console.html title="Getting to Know the Console" class=dd-item><a href=../2-know-the-console.html>Getting to Know the Console</a></li><li data-nav-id=/3-aws-compliance-reports.html title="Accessing AWS Compliance Reports" class=dd-item><a href=../3-aws-compliance-reports.html>AWS Compliance Reports</a><ul><li data-nav-id=/3-aws-compliance-reports/1-intro.html title=Introduction class=dd-item><a href=../3-aws-compliance-reports/1-intro.html><b>1. </b>Introduction</a></li><li data-nav-id=/3-aws-compliance-reports/2-access-a-report.html title="Access a report" class=dd-item><a href=../3-aws-compliance-reports/2-access-a-report.html><b>2. </b>Access a report</a></li><li data-nav-id=/3-aws-compliance-reports/3-interpret-results.html title="Interpreting the results" class=dd-item><a href=../3-aws-compliance-reports/3-interpret-results.html><b>3. </b>Interpreting the results</a></li><li data-nav-id=/3-aws-compliance-reports/4-shared-responsibility.html title="Deep Dive: Shared Responsibility" class=dd-item><a href=../3-aws-compliance-reports/4-shared-responsibility.html><b>4. </b>Deep Dive: Shared Responsibility</a></li></ul></li><li data-nav-id=/4-detective-controls-config.html title="Detective Controls with Config" class=dd-item><a href=../4-detective-controls-config.html>Detective Controls with Config</a><ul><li data-nav-id=/4-detective-controls-config/1-intro.html title=Introduction class=dd-item><a href=../4-detective-controls-config/1-intro.html><b>1. </b>Introduction</a></li><li data-nav-id=/4-detective-controls-config/2-env-setup.html title=Set-up class=dd-item><a href=../4-detective-controls-config/2-env-setup.html><b>2. </b>Set-up</a></li><li data-nav-id=/4-detective-controls-config/3-config-setup.html title="Enable AWS Config" class=dd-item><a href=../4-detective-controls-config/3-config-setup.html><b>3. </b>Enable AWS Config</a></li><li data-nav-id=/4-detective-controls-config/4-add-rules.html title="Add Managed Config Rules" class=dd-item><a href=../4-detective-controls-config/4-add-rules.html><b>4. </b>Add Managed Config Rules</a></li><li data-nav-id=/4-detective-controls-config/5-dashboard.html title="Review Dashboard" class=dd-item><a href=../4-detective-controls-config/5-dashboard.html><b>5. </b>Review Dashboard</a></li><li data-nav-id=/4-detective-controls-config/6-rule-scope.html title="Rule Scope" class=dd-item><a href=../4-detective-controls-config/6-rule-scope.html><b>6. </b>Rule Scope</a></li><li data-nav-id=/4-detective-controls-config/7-remediate.html title="Auto Remediate" class=dd-item><a href=../4-detective-controls-config/7-remediate.html><b>7. </b>Auto Remediate</a></li><li data-nav-id=/4-detective-controls-config/8-timelines.html title="Explore Timelines" class=dd-item><a href=../4-detective-controls-config/8-timelines.html><b>8. </b>Explore Timelines</a></li><li data-nav-id=/4-detective-controls-config/9-clean-up.html title="Clean up" class=dd-item><a href=../4-detective-controls-config/9-clean-up.html><b>9. </b>Clean up</a></li></ul></li><li data-nav-id=/6-patching-controls-ssm.html title="Patching Controls with Systems Manager" class=dd-item><a href=../6-patching-controls-ssm.html>Patching Controls with Systems Manager</a><ul><li data-nav-id=/6-patching-controls-ssm/1-intro.html title=Introduction class=dd-item><a href=../6-patching-controls-ssm/1-intro.html><b>1. </b>Introduction</a></li><li data-nav-id=/6-patching-controls-ssm/2-env-setup.html title=Set-up class=dd-item><a href=../6-patching-controls-ssm/2-env-setup.html><b>2. </b>Set-up</a></li><li data-nav-id=/6-patching-controls-ssm/3-current-os.html title="Determine the current OS versions" class=dd-item><a href=../6-patching-controls-ssm/3-current-os.html><b>3. </b>Determine the current OS versions</a></li><li data-nav-id=/6-patching-controls-ssm/4-set-patch-baselines.html title="Set patch baselines" class=dd-item><a href=../6-patching-controls-ssm/4-set-patch-baselines.html><b>4. </b>Set patch baselines</a></li><li data-nav-id=/6-patching-controls-ssm/5-review-compliance.html title="Review compliance" class=dd-item><a href=../6-patching-controls-ssm/5-review-compliance.html><b>5. </b>Review compliance</a></li><li data-nav-id=/6-patching-controls-ssm/6-maintenance-window.html title="Create a maintenance window" class=dd-item><a href=../6-patching-controls-ssm/6-maintenance-window.html><b>6. </b>Create a maintenance window</a></li><li data-nav-id=/6-patching-controls-ssm/7-patch-manager-config.html title="Create Patch Manager configuration" class=dd-item><a href=../6-patching-controls-ssm/7-patch-manager-config.html><b>7. </b>Create Patch Manager configuration</a></li><li data-nav-id=/6-patching-controls-ssm/8-patch-now.html title="Patch Now" class=dd-item><a href=../6-patching-controls-ssm/8-patch-now.html><b>8. </b>Patch Now</a></li><li data-nav-id=/6-patching-controls-ssm/9-clean-up.html title="Clean up" class=dd-item><a href=../6-patching-controls-ssm/9-clean-up.html><b>9. </b>Clean up</a></li></ul></li><li data-nav-id=/7-preventative-controls-codepipeline.html title="Preventative controls with Code Pipeline" class="dd-item
parent"><a href=../7-preventative-controls-codepipeline.html>Preventative controls with Code Pipeline</a><ul><li data-nav-id=/7-preventative-controls-codepipeline/1-intro.html title=Introduction class=dd-item><a href=../7-preventative-controls-codepipeline/1-intro.html><b>1. </b>Introduction</a></li><li data-nav-id=/7-preventative-controls-codepipeline/3-create-environments.html title="Create environments" class=dd-item><a href=../7-preventative-controls-codepipeline/3-create-environments.html><b>3. </b>Create environments</a></li><li data-nav-id=/7-preventative-controls-codepipeline/4-failed-step.html title="Identify failed resource" class=dd-item><a href=../7-preventative-controls-codepipeline/4-failed-step.html><b>3. </b>Identify failed resource</a></li><li data-nav-id=/7-preventative-controls-codepipeline/5-review-checks.html title="Review checks" class=dd-item><a href=../7-preventative-controls-codepipeline/5-review-checks.html><b>5. </b>Review checks</a></li><li data-nav-id=/7-preventative-controls-codepipeline/6-correct-cfn.html title="Review code pipeline" class=dd-item><a href=../7-preventative-controls-codepipeline/6-correct-cfn.html><b>6. </b>Review code pipeline</a></li><li data-nav-id=/7-preventative-controls-codepipeline/7-check-change.html title="Deploy change" class="dd-item
parent
active"><a href=../7-preventative-controls-codepipeline/7-check-change.html><b>7. </b>Deploy change</a></li><li data-nav-id=/7-preventative-controls-codepipeline/10-clean-up.html title="Clean up" class=dd-item><a href=../7-preventative-controls-codepipeline/10-clean-up.html><b>10. </b>Clean up</a></li></ul></li></ul><section id=footer><left><a href="https://aws.amazon.com/privacy/?nc1=f_pr">Privacy</a> | <a href="https://aws.amazon.com/terms/?nc1=f_pr">Site Terms</a> | © 2020, Amazon Web Services, Inc. or its affiliates. All rights reserved.</left></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=breadcrumbs itemscope itemtype=https://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fa fa-bars"></i></a></span><span class=links><a href=../>Risk & Compliance Workshop</a> > <a href=../7-preventative-controls-codepipeline.html>Preventative controls with Code Pipeline</a> > Deploy change</span></div></div></div><div id=body-inner><h1>Deploy change</h1><p><strong>1. Unzip the change file</strong><br>In Step 1 - <a href=../risk-lab-site/pipeline-controls-intro/get-source-files/>Get Source Files</a> we downloaded the source files. Go to the directory which contains these files and unzip the <span style=display:inline;font-family:courier>codepipe-single-sg.zip</span> file, it contains three files;</p><ul><li><span style=display:inline;font-family:courier>single_security_group_one_cidr_ingress.json</span><br>This file is the main CloudFormation script for our change containing the configuration for the security group that we will deploy first into the Testing Environment, then into the Production Environment.</li><li><span style=display:inline;font-family:courier>test-stack-configuration.json</span><br>This file includes the name of the VPC used for our testing environment.</li><li><span style=display:inline;font-family:courier>prod-stack-configuration.json</span>
This file includes the name of the VPC used for the production environment.</li></ul><p><strong>2. Review the main CloudFormation template</strong><br>First, lets have a look at the <span style=display:inline;font-family:courier>single_security_group_one_cidr_ingress.json</span> file. This file creates a security group - a security group acts as a virtual firewall for your instance to control inbound and outbound traffic.</p><p>We&rsquo;re not going to get into the format or structure of the file in this lab but there are a few lines that we will focus on. Where the file provides the details for the SecurityGroupIngress you can see that the CidrIp range is set to 0.0.0.0/0 and the FromPort is 22. This means that the security group is open to remote connection from any ip address - which we do not want - but lets leave it as is for now.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
  <span style=color:#f92672>&#34;AWSTemplateFormatVersion&#34;</span>: <span style=color:#e6db74>&#34;2010-09-09&#34;</span>,
  <span style=color:#f92672>&#34;Description&#34;</span>: <span style=color:#e6db74>&#34;Sample, test only template that creates a sample Security Group allowing all SSH traffic inbound from 0.0.0.0/0 .  This template is for testing purposes only.&#34;</span>,
  <span style=color:#f92672>&#34;Parameters&#34;</span>: {
    <span style=color:#f92672>&#34;VPCName&#34;</span>: {
      <span style=color:#f92672>&#34;Description&#34;</span>: <span style=color:#e6db74>&#34;ID of the existing VPC.&#34;</span>,
      <span style=color:#f92672>&#34;Type&#34;</span>: <span style=color:#e6db74>&#34;AWS::EC2::VPC::Id&#34;</span>
    }
  },
  <span style=color:#f92672>&#34;Resources&#34;</span>: {
    <span style=color:#f92672>&#34;sg&#34;</span>: {
      <span style=color:#f92672>&#34;Type&#34;</span> : <span style=color:#e6db74>&#34;AWS::EC2::SecurityGroup&#34;</span>,
      <span style=color:#f92672>&#34;Properties&#34;</span> : {
        <span style=color:#f92672>&#34;GroupDescription&#34;</span> : <span style=color:#e6db74>&#34;SSH Security Group&#34;</span>,
        <span style=color:#f92672>&#34;SecurityGroupIngress&#34;</span> : {
          <span style=color:#f92672>&#34;CidrIp&#34;</span>: <span style=color:#e6db74>&#34;0.0.0.0/0&#34;</span>,
          <span style=color:#f92672>&#34;FromPort&#34;</span>: <span style=color:#ae81ff>22</span>,
          <span style=color:#f92672>&#34;ToPort&#34;</span>: <span style=color:#ae81ff>22</span>,
          <span style=color:#f92672>&#34;IpProtocol&#34;</span>: <span style=color:#e6db74>&#34;tcp&#34;</span>
        },
		<span style=color:#f92672>&#34;Tags&#34;</span>: [
			{<span style=color:#f92672>&#34;Key&#34;</span>: <span style=color:#e6db74>&#34;Name&#34;</span>, <span style=color:#f92672>&#34;Value&#34;</span>: <span style=color:#e6db74>&#34;Immersion-Day-Demo&#34;</span>},
			{<span style=color:#f92672>&#34;Key&#34;</span>: <span style=color:#e6db74>&#34;LOB&#34;</span>, <span style=color:#f92672>&#34;Value&#34;</span>: <span style=color:#e6db74>&#34;Risk-&amp;-Compliance&#34;</span>}
		],
        <span style=color:#f92672>&#34;VpcId&#34;</span> : { <span style=color:#f92672>&#34;Ref&#34;</span> : <span style=color:#e6db74>&#34;VPCName&#34;</span> }}
      }
  }
}
</code></pre></div><p><strong>3. Update the CloudFormation templates</strong><br>Next we will update the two configuration files with the names of the VPCs we noted in Step 5 - <a href=../risk-lab-site/pipeline-controls-intro/5-check-cf/>Check CloudFormation</a>.</p><ul><li><span style=display:inline;font-family:courier>test-stack-configuration.json</span><br>Update the VPCName to the name of your test environment VPC.</li><li><span style=display:inline;font-family:courier>prod-stack-configuration.json</span>
Update the VPCName to the name of your production environment VPC.</li></ul><p>Your <span style=display:inline;font-family:courier>test-stack-configuration.json</span> and <span style=display:inline;font-family:courier>prod-stack-configuration.json</span> files should look like this but with your vpc as the value for VPCName.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
  <span style=color:#f92672>&#34;Parameters&#34;</span> : {
    <span style=color:#f92672>&#34;VPCName&#34;</span> : <span style=color:#e6db74>&#34;vpc-cd0dd4a9&#34;</span>
  }
}
</code></pre></div><p>Don&rsquo;t forget to save your changes.</p><p><strong>4. Create new <span style=display:inline;font-family:courier>codepipe-single-sg.zip</span> file</strong><br>Zip up the three files into a new <span style=display:inline;font-family:courier>codepipe-single-sg.zip</span></p><p><strong>5. Upload the CloudFormation script to the code repository bucket</strong><br>Upload the new <span style=display:inline;font-family:courier>codepipe-single-sg.zip</span> file into the S3 bucket you created in Step 2 - <a href=../risk-lab-site/pipeline-controls-intro/create-repo-bucket/>Create Repo Bucket</a>.</p><p><strong>6. Go to the Pipeline</strong><br>The AWS CodePipeline will detect that the file is in the S3 bucket and will run automatically, or you can click on the pipeline name and click <span style="display:inline;font-weight:400;padding:5px 15px;color:#fff;border-style:solid;border-width:1px;background-color:#e3661b">Release change</span></p><p><img src=codepipeline-static-failed.png alt="Bucket not versioned"></p><p>You can see that the StaticCodeAnalysis stage has failed, to see why click the
<span style=display:inline;font-weight:700;color:#6495ed>Details</span> link just below
<span style=display:inline;font-weight:700;color:Red>Failed</span>.</p><p><img src=codepipeline-action-execution-failed.png alt="Bucket not versioned"></p><p>You can see the execution failed due to <strong>&ldquo;Failed filters &lsquo;IngressOpenToWorld&rsquo;, &lsquo;SSHOpenToWorld&rsquo;"</strong>. This is exactly the issue we saw when we reviewed the code earlier. To dive even deeper click
<span style=display:inline;font-weight:700;color:#6495ed>Link to execution details</span>. this will take you to <a href=https://aws.amazon.com/cloudwatch/ target=_blank>Amazon CloudWatch</a>.</p><p><img src=cloudwatch-log.png alt="CloudWatch Log"></p><footer class=footline></footer></div></div><div id=navigation><a class="nav nav-prev" href=../7-preventative-controls-codepipeline/6-correct-cfn.html title="Review code pipeline"><i class="fa fa-chevron-left"></i></a><a class="nav nav-next" href=../7-preventative-controls-codepipeline/10-clean-up.html title="Clean up" style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=../js/clipboard.min.js></script><script src=../js/perfect-scrollbar.min.js></script><script src=../js/perfect-scrollbar.jquery.min.js></script><script src=../js/jquery.sticky.js></script><script src=../js/featherlight.min.js></script><script src=../js/html5shiv-printshiv.min.js></script><script src=../js/highlight.pack.js></script><script>hljs.initHighlightingOnLoad();</script><script src=../js/modernizr.custom-3.6.0.js></script><script src=../js/learn.js></script><script src=../js/hugo-learn.js></script><link href=../mermaid/mermaid.css rel=stylesheet><script src=../mermaid/mermaid.js></script><script>mermaid.initialize({startOnLoad:true});</script></body></html>