<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.74.3"><meta name=description content="Hands on labs for those interested in risk & assurance, and compliance."><meta name=author content="Paul Curtis"><link rel=icon href=/risk-lab-site/images/favicon.png type=image/png><title>Deploy First Change :: Risk & Compliance Labs</title><link href=/risk-lab-site/css/nucleus.css?1598946121 rel=stylesheet><link href=/risk-lab-site/css/fontawesome-all.min.css?1598946121 rel=stylesheet><link href=/risk-lab-site/css/hybrid.css?1598946121 rel=stylesheet><link href=/risk-lab-site/css/featherlight.min.css?1598946121 rel=stylesheet><link href=/risk-lab-site/css/theme.css?1598946121 rel=stylesheet><link href=/risk-lab-site/css/hugo-theme.css?1598946121 rel=stylesheet><link href=/risk-lab-site/css/theme-labs.css?1598946121 rel=stylesheet><script src=/risk-lab-site/js/jquery-3.3.1.min.js?1598946121></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=/risk-lab-site/pipeline-controls-intro/7-depoly-first-chenge/><nav id=sidebar><div id=header-wrapper><div id=header><a id=logo href=http://paulJRCurtis.github.io/risk-lab-site/><img src=/risk-lab-site/images/AWS_AWS_logo_RGB_REV.png alt=AWS></a></div></div><div class=highlightable><ul class=topics><li data-nav-id=/risk-lab-site/1-start-workshop/ title="Start the Workshop" class=dd-item><a href=/risk-lab-site/1-start-workshop/><b></b>Start the Workshop</a><ul><li data-nav-id=/risk-lab-site/1-start-workshop/on-your-own/ title="In your own account" class=dd-item><a href=/risk-lab-site/1-start-workshop/on-your-own/><b></b>On your own</a><ul><li data-nav-id=/risk-lab-site/1-start-workshop/on-your-own/create-an-aws-account/ title="Create an AWS Account" class=dd-item><a href=/risk-lab-site/1-start-workshop/on-your-own/create-an-aws-account/><b></b>Create an AWS Account</a></li></ul></li><li data-nav-id=/risk-lab-site/1-start-workshop/at-an-aws-event/ title="At an AWS Event" class=dd-item><a href=/risk-lab-site/1-start-workshop/at-an-aws-event/>At an AWS Event</a><ul><li data-nav-id=/risk-lab-site/1-start-workshop/at-an-aws-event/aws-workshop-portal/ title="AWS Workshop Portal" class=dd-item><a href=/risk-lab-site/1-start-workshop/at-an-aws-event/aws-workshop-portal/><b></b>AWS Workshop Portal</a></li></ul></li></ul></li><li data-nav-id=/risk-lab-site/2-know-the-console/ title="Getting to Know the Console" class=dd-item><a href=/risk-lab-site/2-know-the-console/>Getting to Know the Console</a></li><li data-nav-id=/risk-lab-site/3-aws-compliance-reports/ title="Accessing AWS Compliance Reports" class=dd-item><a href=/risk-lab-site/3-aws-compliance-reports/>AWS Compliance Reports</a><ul><li data-nav-id=/risk-lab-site/3-aws-compliance-reports/1-access-a-report/ title="Access a report" class=dd-item><a href=/risk-lab-site/3-aws-compliance-reports/1-access-a-report/><b>1. </b>Access a report</a></li><li data-nav-id=/risk-lab-site/3-aws-compliance-reports/2-interpret-results/ title="Interpreting the results" class=dd-item><a href=/risk-lab-site/3-aws-compliance-reports/2-interpret-results/><b>2. </b>Interpreting the results</a></li><li data-nav-id=/risk-lab-site/3-aws-compliance-reports/3-optional-shared-responsibility/ title="Optional: Shared Responsibility" class=dd-item><a href=/risk-lab-site/3-aws-compliance-reports/3-optional-shared-responsibility/><b>Optional: </b>Advanced Shared Responsibility</a></li></ul></li><li data-nav-id=/risk-lab-site/4-detective-controls-config/ title="Detective Controls with Config" class=dd-item><a href=/risk-lab-site/4-detective-controls-config/>Detective Controls with Config</a><ul><li data-nav-id=/risk-lab-site/4-detective-controls-config/1-config-setup/ title="Enable AWS Config" class=dd-item><a href=/risk-lab-site/4-detective-controls-config/1-config-setup/><b>1. </b>Enable AWS Config</a></li><li data-nav-id=/risk-lab-site/4-detective-controls-config/2-select-rules/ title="Select AWS Config Rules" class=dd-item><a href=/risk-lab-site/4-detective-controls-config/2-select-rules/><b>2. </b>Select AWS Config Rules</a></li><li data-nav-id=/risk-lab-site/4-detective-controls-config/3-dashboard/ title="Review Dashboard" class=dd-item><a href=/risk-lab-site/4-detective-controls-config/3-dashboard/><b>3. </b>Review Dashboard</a></li><li data-nav-id=/risk-lab-site/4-detective-controls-config/5-remediate/ title=Remediate class=dd-item><a href=/risk-lab-site/4-detective-controls-config/5-remediate/><b>5. </b>Remediate</a></li><li data-nav-id=/risk-lab-site/4-detective-controls-config/6-timelines/ title="Explore Timelines" class=dd-item><a href=/risk-lab-site/4-detective-controls-config/6-timelines/><b>6. </b>Explore Timelines</a></li></ul></li><li data-nav-id=/risk-lab-site/conformance-packs/ title="Corrective controls with Conformance Packs" class=dd-item><a href=/risk-lab-site/conformance-packs/>Corrective controls with Conformance Packs</a><ul><li data-nav-id=/risk-lab-site/conformance-packs/1-introduction/ title=Introduction class=dd-item><a href=/risk-lab-site/conformance-packs/1-introduction/><b>1. </b>Introduction</a></li><li data-nav-id=/risk-lab-site/conformance-packs/2-setup-prerequisite-resources/ title="Setup Prerequisite Resources" class=dd-item><a href=/risk-lab-site/conformance-packs/2-setup-prerequisite-resources/><b>2. </b>Setup Prerequisite Resources</a></li><li data-nav-id=/risk-lab-site/conformance-packs/3-enable-aws-config/ title="Enable AWS Config" class=dd-item><a href=/risk-lab-site/conformance-packs/3-enable-aws-config/><b>3. </b>Enable AWS Config</a></li><li data-nav-id=/risk-lab-site/conformance-packs/4-deploy-conformance-pack/ title="Deploy Conformance Pack" class=dd-item><a href=/risk-lab-site/conformance-packs/4-deploy-conformance-pack/><b>4. </b>Deploy Conformance Pack</a></li><li data-nav-id=/risk-lab-site/conformance-packs/5-view-compliance-and-remediation/ title="View Compliance and Remediation" class=dd-item><a href=/risk-lab-site/conformance-packs/5-view-compliance-and-remediation/><b>5. </b>View Compliance and Remediation</a></li><li data-nav-id=/risk-lab-site/conformance-packs/6-clean-up/ title=Clean-up class=dd-item><a href=/risk-lab-site/conformance-packs/6-clean-up/><b>6. </b>Clean-up</a></li><li data-nav-id=/risk-lab-site/conformance-packs/7-learn-more/ title="Learn More" class=dd-item><a href=/risk-lab-site/conformance-packs/7-learn-more/><b>7. </b>Learn More</a></li></ul></li><li data-nav-id=/risk-lab-site/pipeline-controls-intro/ title="Preventative controls with Code Pipeline" class="dd-item
parent"><a href=/risk-lab-site/pipeline-controls-intro/>Preventative controls with Code Pipeline</a><ul><li data-nav-id=/risk-lab-site/pipeline-controls-intro/1-get-source-files/ title="Get Source Files" class=dd-item><a href=/risk-lab-site/pipeline-controls-intro/1-get-source-files/><b>1. </b>Get Source Files</a></li><li data-nav-id=/risk-lab-site/pipeline-controls-intro/2-create-repo-bucket/ title="Create Repo Bucket" class=dd-item><a href=/risk-lab-site/pipeline-controls-intro/2-create-repo-bucket/><b>2. </b>Create Repo Bucket</a></li><li data-nav-id=/risk-lab-site/pipeline-controls-intro/3-create-environments/ title="Create Environments" class=dd-item><a href=/risk-lab-site/pipeline-controls-intro/3-create-environments/><b>3. </b>Create Environments</a></li><li data-nav-id=/risk-lab-site/pipeline-controls-intro/4-create-pipeline/ title="Create a Pipeline" class=dd-item><a href=/risk-lab-site/pipeline-controls-intro/4-create-pipeline/><b>4. </b>Create a Pipeline</a></li><li data-nav-id=/risk-lab-site/pipeline-controls-intro/5-check-cf/ title="Check CloudFormation" class=dd-item><a href=/risk-lab-site/pipeline-controls-intro/5-check-cf/><b>5. </b>Check CloudFormation</a></li><li data-nav-id=/risk-lab-site/pipeline-controls-intro/6-review-pipeline/ title="Review Code Pipeline" class=dd-item><a href=/risk-lab-site/pipeline-controls-intro/6-review-pipeline/><b>6. </b>Review Code Pipeline</a></li><li data-nav-id=/risk-lab-site/pipeline-controls-intro/7-depoly-first-chenge/ title="Deploy First Change" class="dd-item
parent
active"><a href=/risk-lab-site/pipeline-controls-intro/7-depoly-first-chenge/><b>7. </b>Deploy First Change</a></li><li data-nav-id=/risk-lab-site/pipeline-controls-intro/8-edit-change/ title="Edit Change & Redeploy" class=dd-item><a href=/risk-lab-site/pipeline-controls-intro/8-edit-change/><b>8 </b>Edit Change & Redeploy</a></li><li data-nav-id=/risk-lab-site/pipeline-controls-intro/9-review-sg/ title="Review Security Group" class=dd-item><a href=/risk-lab-site/pipeline-controls-intro/9-review-sg/><b>9. </b>Review Security Group</a></li><li data-nav-id=/risk-lab-site/pipeline-controls-intro/10-clean-up/ title="Clean Up" class=dd-item><a href=/risk-lab-site/pipeline-controls-intro/10-clean-up/><b>10. </b>Clean Up</a></li></ul></li></ul><section id=footer><p>Built with <a href=https://github.com/matcornic/hugo-theme-learn><i class="fas fa-heart"></i></a>from <a href=https://getgrav.org>Grav</a> and <a href=https://gohugo.io/>Hugo</a></p></section></div></nav><section id=body><div class="padding highlightable"><div id=top-bar><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i></a></span><span class=links><a href=/risk-lab-site/>Risk & Compliance Labs</a> > <a href=/risk-lab-site/pipeline-controls-intro/>Preventative controls with Code Pipeline</a> > Deploy First Change</span></div></div><div id=head-tags></div><div id=body-inner><h1>Deploy First Change</h1><p></p><p><strong>1. Unzip the change file</strong><br>In Step 1 - <a href=/risk-lab-site/pipeline-controls-intro/get-source-files/>Get Source Files</a> we downloaded the source files. Go to the directory which contains these files and unzip the <span style=display:inline;font-family:courier>codepipe-single-sg.zip</span> file, it contains three files;</p><ul><li><span style=display:inline;font-family:courier>single_security_group_one_cidr_ingress.json</span><br>This file is the main CloudFormation script for our change containing the configuration for the security group that we will deploy first into the Testing Environment, then into the Production Environment.</li><li><span style=display:inline;font-family:courier>test-stack-configuration.json</span><br>This file includes the name of the VPC used for our testing environment.</li><li><span style=display:inline;font-family:courier>prod-stack-configuration.json</span>
This file includes the name of the VPC used for the production environment.</li></ul><p><strong>2. Review the main CloudFormation template</strong><br>First, lets have a look at the <span style=display:inline;font-family:courier>single_security_group_one_cidr_ingress.json</span> file. This file creates a security group - a security group acts as a virtual firewall for your instance to control inbound and outbound traffic.</p><p>We&rsquo;re not going to get into the format or structure of the file in this lab but there are a few lines that we will focus on. Where the file provides the details for the SecurityGroupIngress you can see that the CidrIp range is set to 0.0.0.0/0 and the FromPort is 22. This means that the security group is open to remote connection from any ip address - which we do not want - but lets leave it as is for now.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
  <span style=color:#f92672>&#34;AWSTemplateFormatVersion&#34;</span>: <span style=color:#e6db74>&#34;2010-09-09&#34;</span>,
  <span style=color:#f92672>&#34;Description&#34;</span>: <span style=color:#e6db74>&#34;Sample, test only template that creates a sample Security Group allowing all SSH traffic inbound from 0.0.0.0/0 .  This template is for testing purposes only.&#34;</span>,
  <span style=color:#f92672>&#34;Parameters&#34;</span>: {
    <span style=color:#f92672>&#34;VPCName&#34;</span>: {
      <span style=color:#f92672>&#34;Description&#34;</span>: <span style=color:#e6db74>&#34;ID of the existing VPC.&#34;</span>,
      <span style=color:#f92672>&#34;Type&#34;</span>: <span style=color:#e6db74>&#34;AWS::EC2::VPC::Id&#34;</span>
    }
  },
  <span style=color:#f92672>&#34;Resources&#34;</span>: {
    <span style=color:#f92672>&#34;sg&#34;</span>: {
      <span style=color:#f92672>&#34;Type&#34;</span> : <span style=color:#e6db74>&#34;AWS::EC2::SecurityGroup&#34;</span>,
      <span style=color:#f92672>&#34;Properties&#34;</span> : {
        <span style=color:#f92672>&#34;GroupDescription&#34;</span> : <span style=color:#e6db74>&#34;SSH Security Group&#34;</span>,
        <span style=color:#f92672>&#34;SecurityGroupIngress&#34;</span> : {
          <span style=color:#f92672>&#34;CidrIp&#34;</span>: <span style=color:#e6db74>&#34;0.0.0.0/0&#34;</span>,
          <span style=color:#f92672>&#34;FromPort&#34;</span>: <span style=color:#ae81ff>22</span>,
          <span style=color:#f92672>&#34;ToPort&#34;</span>: <span style=color:#ae81ff>22</span>,
          <span style=color:#f92672>&#34;IpProtocol&#34;</span>: <span style=color:#e6db74>&#34;tcp&#34;</span>
        },
		<span style=color:#f92672>&#34;Tags&#34;</span>: [
			{<span style=color:#f92672>&#34;Key&#34;</span>: <span style=color:#e6db74>&#34;Name&#34;</span>, <span style=color:#f92672>&#34;Value&#34;</span>: <span style=color:#e6db74>&#34;Immersion-Day-Demo&#34;</span>},
			{<span style=color:#f92672>&#34;Key&#34;</span>: <span style=color:#e6db74>&#34;LOB&#34;</span>, <span style=color:#f92672>&#34;Value&#34;</span>: <span style=color:#e6db74>&#34;Risk-&amp;-Compliance&#34;</span>}
		],
        <span style=color:#f92672>&#34;VpcId&#34;</span> : { <span style=color:#f92672>&#34;Ref&#34;</span> : <span style=color:#e6db74>&#34;VPCName&#34;</span> }}
      }
  }
}
</code></pre></div><p><strong>3. Update the CloudFormation templates</strong><br>Next we will update the two configuration files with the names of the VPCs we noted in Step 5 - <a href=/risk-lab-site/pipeline-controls-intro/5-check-cf/>Check CloudFormation</a>.</p><ul><li><span style=display:inline;font-family:courier>test-stack-configuration.json</span><br>Update the VPCName to the name of your test environment VPC.</li><li><span style=display:inline;font-family:courier>prod-stack-configuration.json</span>
Update the VPCName to the name of your production environment VPC.</li></ul><p>Your <span style=display:inline;font-family:courier>test-stack-configuration.json</span> and <span style=display:inline;font-family:courier>prod-stack-configuration.json</span> files should look like this but with your vpc as the value for VPCName.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
  <span style=color:#f92672>&#34;Parameters&#34;</span> : {
    <span style=color:#f92672>&#34;VPCName&#34;</span> : <span style=color:#e6db74>&#34;vpc-cd0dd4a9&#34;</span>
  }
}
</code></pre></div><p>Don&rsquo;t forget to save your changes.</p><p><strong>4. Create new <span style=display:inline;font-family:courier>codepipe-single-sg.zip</span> file</strong><br>Zip up the three files into a new <span style=display:inline;font-family:courier>codepipe-single-sg.zip</span></p><p><strong>5. Upload the CloudFormation script to the code repository bucket</strong><br>Upload the new <span style=display:inline;font-family:courier>codepipe-single-sg.zip</span> file into the S3 bucket you created in Step 2 - <a href=/risk-lab-site/pipeline-controls-intro/create-repo-bucket/>Create Repo Bucket</a>.</p><p><strong>6. Go to the Pipeline</strong><br>The AWS CodePipeline will detect that the file is in the S3 bucket and will run automatically, or you can click on the pipeline name and click <span style="display:inline;font-weight:700;padding:5px 15px;color:#fff;border-style:solid;border-width:1px;background-color:#e3661b">Release change</span></p><p><img src=codepipeline-static-failed.png alt="Bucket not versioned"></p><p>You can see that the StaticCodeAnalysis stage has failed, to see why click the
<span style=display:inline;font-weight:700;color:#6495ed>Details</span> link just below
<span style=display:inline;font-weight:700;color:Red>Failed</span>.</p><p><img src=codepipeline-action-execution-failed.png alt="Bucket not versioned"></p><p>You can see the execution failed due to <strong>&ldquo;Failed filters &lsquo;IngressOpenToWorld&rsquo;, &lsquo;SSHOpenToWorld&rsquo;"</strong>. This is exactly the issue we saw when we reviewed the code earlier. To dive even deeper click
<span style=display:inline;font-weight:700;color:#6495ed>Link to execution details</span>. this will take you to <a href=https://aws.amazon.com/cloudwatch/ target=_blank>Amazon CloudWatch</a>.</p><p><img src=cloudwatch-log.png alt="CloudWatch Log"></p></div></div><div id=navigation><a class="nav nav-prev" href=/risk-lab-site/pipeline-controls-intro/6-review-pipeline/ title="Review Code Pipeline"><i class="fa fa-chevron-left"></i></a><a class="nav nav-next" href=/risk-lab-site/pipeline-controls-intro/8-edit-change/ title="Edit Change & Redeploy" style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></section><footer class=footline><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/risk-lab-site/js/clipboard.min.js?1598946121></script><script src=/risk-lab-site/js/perfect-scrollbar.min.js?1598946121></script><script src=/risk-lab-site/js/perfect-scrollbar.jquery.min.js?1598946121></script><script src=/risk-lab-site/js/jquery.sticky.js?1598946121></script><script src=/risk-lab-site/js/featherlight.min.js?1598946121></script><script src=/risk-lab-site/js/highlight.pack.js?1598946121></script><script>hljs.initHighlightingOnLoad();</script><script src=/risk-lab-site/js/modernizr.custom-3.6.0.js?1598946121></script><script src=/risk-lab-site/js/learn.js?1598946121></script><script src=/risk-lab-site/js/hugo-learn.js?1598946121></script><link href=/risk-lab-site/mermaid/mermaid.css?1598946121 rel=stylesheet><script src=/risk-lab-site/mermaid/mermaid.js?1598946121></script><script>mermaid.initialize({startOnLoad:true});</script></footer></body></html>